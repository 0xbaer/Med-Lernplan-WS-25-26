<!DOCTYPE html>
<html lang="de" class="h-full bg-gray-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dein Med-Lernplan WS 25/26 (V8 - Dynamische Tasks)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .task-item input:checked + label {
            text-decoration: line-through;
            color: #6b7280;
        }
        .task-item label {
            transition: color 0.2s ease-in-out;
            cursor: pointer;
        }
        /* Kleine Lade-Animation für den Sync-Status */
        #auth-status.syncing::after {
            content: ' .';
            animation: dots 1s steps(5, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: ' .'; }
            40% { content: ' ..'; }
            60% { content: ' ...'; }
            80%, 100% { content: ' '; }
        }
        .delete-task-btn {
            opacity: 0.3;
            transition: opacity 0.2s;
            cursor: pointer;
            font-weight: bold;
            padding: 0 4px;
        }
        .task-item:hover .delete-task-btn {
            opacity: 1;
        }
    </style>
</head>
<body class="h-full p-4 md:p-8 bg-gray-100">
    <div class="max-w-7xl mx-auto">
        <header class="mb-8">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">Dein Med-Lernplan WS 25/26 (V8)</h1>
                    <p class="text-lg text-gray-600">Interaktiver Plan - Jetzt mit dynamischen Tasks & DB-Sync.</p>
                </div>
                <div class="text-right">
                    <span id="auth-status" class="text-sm text-gray-500">Initialisiere...</span>
                </div>
            </div>
        </header>

        <!-- Container für die Lernphasen -->
        <div class="space-y-8">

            <!-- Phase 1: Aktueller Fokus -->
            <section class="bg-white p-6 rounded-xl shadow-lg border border-blue-200">
                <h2 class="text-2xl font-semibold text-blue-700 mb-4">Phase 1: Aktueller Fokus (Bis 07.11.2025)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Ziel dieser Woche</h3>
                        <p class="p-4 bg-blue-50 rounded-lg text-blue-800">
                            <strong>Testat:</strong> Wöchentlicher Physio-Test (07.11.)
                        </p>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Tracking-Liste</h3>
                        <!-- NEU: Form zum Hinzufügen -->
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="new-task-input-phase1" placeholder="Neue Aufgabe..." class="flex-grow border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-300">
                            <button data-phase="phase1" class="add-task-btn bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-semibold">Add</button>
                        </div>
                        <!-- Liste wird dynamisch gefüllt -->
                        <ul class="space-y-2 task-list" id="phase1-tasks">
                            <!-- JS fügt Tasks hier ein -->
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Phase 2: Der Große Dauerlauf -->
            <section class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Phase 2: Der große Dauerlauf (08.11. - 20.12.2025)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Ziele</h3>
                        <ul class="space-y-3">
                            <li class="p-4 bg-red-50 rounded-lg text-red-800 font-medium"><strong>Ana-Blöcke 1-3</strong> (Rumpf, Arm, Bein)</li>
                            <li class="p-4 bg-orange-50 rounded-lg text-orange-800 font-medium"><strong>Dauerlauf</strong> AC-Selbststudium</li>
                            <li class="p-4 bg-blue-50 rounded-lg text-blue-800"><strong>Dauerlauf:</strong> Wöchentliche Physio-Tests</li>
                            <li class="p-4 bg-blue-100 rounded-lg text-blue-900 border border-blue-300">
                                <strong>Physio-Ziel:</strong> 26 Punkte (min.)<br>
                                <strong>Status:</strong> 11/26<br>
                                <strong>Bedarf:</strong> 15 Punkte aus 6 Tests (Schnitt: 2.5/6)
                            </li>
                            <li class="p-4 bg-yellow-50 rounded-lg text-yellow-800"><strong>Klausur:</strong> Med. Psychologie (09.12.)</li>
                            <li class="p-4 bg-teal-50 rounded-lg text-teal-800"><strong>Urlaub:</strong> 19.11. - 21.11. (Buenos Aires!)</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Tracking-Liste</h3>
                        <!-- NEU: Form zum Hinzufügen -->
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="new-task-input-phase2" placeholder="Neue Aufgabe..." class="flex-grow border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300">
                            <button data-phase="phase2" class="add-task-btn bg-gray-700 hover:bg-gray-800 text-white px-3 py-2 rounded-lg text-sm font-semibold">Add</button>
                        </div>
                        <!-- Liste wird dynamisch gefüllt -->
                        <ul class="space-y-2 task-list" id="phase2-tasks">
                            <!-- JS fügt Tasks hier ein -->
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Phase 3: Fokus Anatomie & Biochemie -->
            <section class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Phase 3: Ana-Endspurt & Biochemie (21.12.2025 - 20.01.2026)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Hauptziele</h3>
                         <ul class="space-y-3">
                            <li class="p-4 bg-teal-50 rounded-lg text-teal-800 font-medium"><strong>WEIHNACHTSPAUSE:</strong> (21.12. - 26.12.)</li>
                            <li class="p-4 bg-red-50 rounded-lg text-red-800"><strong>Ana-Blöcke 4-6</strong> (Organe, Kopf/Hals)</li>
                            <li class="p-4 bg-green-50 rounded-lg text-green-800 font-medium"><strong>Start Biochemie Praktikum:</strong> 07.01.2026</li>
                            <li class="p-4 bg-red-100 rounded-lg text-red-900 font-medium border border-red-300"><strong>FINALE: Ganzkörpertestat:</strong> 20.01.2026</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Tracking-Liste (NEU mit Weihnachtspause)</h3>
                        <!-- NEU: Form zum Hinzufügen -->
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="new-task-input-phase3" placeholder="Neue Aufgabe..." class="flex-grow border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300">
                            <button data-phase="phase3" class="add-task-btn bg-gray-700 hover:bg-gray-800 text-white px-3 py-2 rounded-lg text-sm font-semibold">Add</button>
                        </div>
                        <!-- Liste wird dynamisch gefüllt -->
                        <ul class="space-y-2 task-list" id="phase3-tasks">
                            <!-- JS fügt Tasks hier ein -->
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Phase 4: Klausurenphase -->
            <section class="bg-white p-6 rounded-xl shadow-lg border border-red-300">
                <h2 class="text-2xl font-semibold text-red-700 mb-4">Phase 4: Klausurenphase (21.01. - 07.02.2026)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Alle Klausuren</h3>
                        <ul class="space-y-3">
                            <li class="p-4 bg-gray-50 rounded-lg text-gray-800">
                                <strong>Biochemie:</strong> 04.02.2026 (9:00)
                            </li>
                            <li class="p-4 bg-gray-50 rounded-lg text-gray-800">
                                <strong>Terminologie:</strong> 04.02.2026 (11:00)
                            </li>
                            <li class="p-4 bg-gray-50 rounded-lg text-gray-800">
                                <strong>Biologie:</strong> 06.02.2026 (12:00)
                            </li>
                            <li class="p-4 bg-gray-50 rounded-lg text-gray-800">
                                <strong>Chemie (AC):</strong> 07.02.2026 (9:00)
                            </li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Tracking-Liste</h3>
                        <!-- NEU: Form zum Hinzufügen -->
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="new-task-input-phase4" placeholder="Neue Aufgabe..." class="flex-grow border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-red-300">
                            <button data-phase="phase4" class="add-task-btn bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm font-semibold">Add</button>
                        </div>
                        <!-- Liste wird dynamisch gefüllt -->
                        <ul class="space-y-2 task-list" id="phase4-tasks">
                            <!-- JS fügt Tasks hier ein -->
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Phase 5: Langfristige Ziele -->
            <section class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Phase 5: Langfristige Ziele (Frühjahr 2026)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Zukünftige Prüfungen</h3>
                         <ul class="space-y-3">
                            <li class="p-4 bg-blue-50 rounded-lg text-blue-800"><strong>Physiologie Praktikum:</strong> 11.03. - 02.04.2026</li>
                            <li class="p-4 bg-blue-50 rounded-lg text-blue-800 font-medium"><strong>Klausur Physiologie:</strong> 09.04.2026</li>
                            <li class="p-4 bg-yellow-50 rounded-lg text-yellow-800"><strong>Klausur Chemie (OC):</strong> April 2026 (TBD)</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Tracking-Liste</h3>
                        <!-- NEU: Form zum Hinzufügen -->
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="new-task-input-phase5" placeholder="Neue Aufgabe..." class="flex-grow border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300">
                            <button data-phase="phase5" class="add-task-btn bg-gray-700 hover:bg-gray-800 text-white px-3 py-2 rounded-lg text-sm font-semibold">Add</button>
                        </div>
                        <!-- Liste wird dynamisch gefüllt -->
                        <ul class="space-y-2 task-list" id="phase5-tasks">
                            <!-- JS fügt Tasks hier ein -->
                        </ul>
                    </div>
                </div>
            </section>

        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Importiere notwendige Firebase Module
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Globale Variablen ---
        let db;
        let auth;
        let userId = null;
        let dbRef = null; // Referenz zum Firestore-Dokument
        let debounceTimer; // Für verzögertes Speichern
        
        const statusElement = document.getElementById('auth-status');
        
        // --- NEU: Standard-Aufgabenstruktur ---
        // Dies ist der "Fallback", falls nichts in der DB gespeichert ist.
        let taskState = {
            phase1: [
                { id: 'task1-1', text: 'Thema "Blut I" (Zusammensetzung) lernen', checked: false },
                { id: 'task1-2', text: 'Thema "Erythrozyten & Anämien" verstehen', checked: false },
                { id: 'task1-3', text: 'Thema "Blutgruppen" wiederholen', checked: false },
                { id: 'task1-4', text: 'Plan für AC-Selbststudium erstellen (z.B. 1 Thema/Woche)', checked: false }
            ],
            phase2: [
                { id: 'task2-ana-1', text: 'Ana-Block 1: Rumpfwand & Rücken (bis ca. 22.11.)', checked: false, style: 'font-semibold text-red-700' },
                { id: 'task2-3', text: 'Wöchentlich 1-2 feste Blöcke für AC-Selbststudium einplanen', checked: false },
                { id: 'task2-4', text: 'Physio Test (14.11.): Blut II (Hämostase, Immunologie)', checked: false },
                { id: 'task-vacation', text: 'Blocker: URLAUB (19.11. - 21.11.)', checked: true, disabled: true, style: 'text-teal-700 font-medium' },
                { id: 'task2-5', text: 'Nachholen (nach 21.11.): Physio-Stoff "Energiehaushalt"', checked: false },
                { id: 'task2-ana-2', text: 'Ana-Block 2: Obere Extremität (bis ca. 06.12.)', checked: false, style: 'font-semibold text-red-700' },
                { id: 'task2-6', text: 'Ab 25.11.: Intensiv-Lernphase Med. Psychologie starten', checked: false },
                { id: 'task2-7', text: 'Physio Test (28.11.): Atmung I', checked: false },
                { id: 'task2-8', text: 'Physio Test (05.12.): Atmung II', checked: false },
                { id: 'task2-9', text: 'Physio Test (12.12.): Niere I', checked: false },
                { id: 'task2-ana-3', text: 'Ana-Block 3: Untere Extremität (bis ca. 20.12.)', checked: false, style: 'font-semibold text-red-700' },
                { id: 'task2-10', text: 'Physio Test (19.12.): Elektrolyt-/Säure-Basen', checked: false },
                { id: 'task2-histo', text: 'Histo: Themen parallel zu Makro-Blöcken lernen', checked: false }
            ],
            phase3: [
                { id: 'task-xmas', text: 'Blocker: WEIHNACHTSPAUSE (21.12. - 26.12.)', checked: true, disabled: true, style: 'text-teal-700 font-medium' },
                { id: 'task3-ana-4', text: 'Ana-Block 4: Brustorgane (27.12. - 05.01.)', checked: false, style: 'font-semibold text-red-700' },
                { id: 'task3-2', text: 'Vor 07.01.: Überblick Biochemie-Praktikumsthemen', checked: false },
                { id: 'task3-3', text: 'Praktikum (ab 07.01.) täglich vor/nachbereiten', checked: false },
                { id: 'task3-ana-5', text: 'Ana-Block 5: Bauch- & Beckenorgane (06.01. - 12.01.)', checked: false, style: 'font-semibold text-red-700' },
                { id: 'task3-ana-6', text: 'Ana-Block 6: Kopf & Hals (13.01. - 18.01.)', checked: false, style: 'font-semibold text-red-700' },
                { id: 'task3-ana-7', text: 'Ana-Block 7: Puffer & Finale Repetition (19.01. - 20.01.)', checked: false, style: 'font-bold text-red-900' },
                { id: 'task3-5', text: 'Parallel AC-Selbststudium weiterführen!', checked: false }
            ],
            phase4: [
                { id: 'task4-1', text: 'Ab 21.01.: Fokus auf Biochemie (Nachbereitung Praktikum) & Termi', checked: false },
                { id: 'task4-2', text: 'Terminologie Vokabeln lernen', checked: false },
                { id: 'task4-3', text: '04.02. & 05.02.: Fokus auf Biologie für Mediziner', checked: false },
                { id: 'task4-4', text: '06.02.: Finale Lernphase für AC-Klausur', checked: false }
            ],
            phase5: [
                { id: 'task5-1', text: 'Nach Feb-Klausuren: Pause machen!', checked: false },
                { id: 'task5-2', text: 'Ab Ende Feb.: Physiologie-Stoff der Wochentests reaktivieren', checked: false },
                { id: 'task5-3', text: 'Physiologie-Praktikum (März) intensiv nutzen', checked: false },
                { id: 'task5-4', text: 'Lernplan für OC-Klausur erstellen', checked: false }
            ]
        };

        // --- Initialisierung ---
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- HIER DEINE FIREBASE KONFIGURATION EINFÜGEN ---
            const firebaseConfig = {
                apiKey: "DEIN_API_KEY", // Ersetze "DEIN_API_KEY"
                authDomain: "DEIN_PROJEKT.firebaseapp.com",
                projectId: "DEIN_PROJEKT_ID",
                storageBucket: "DEIN_PROJEKT.appspot.com",
                messagingSenderId: "DEIN_SENDER_ID",
                appId: "DEIN_APP_ID"
            };
            
            const appId = firebaseConfig.projectId || 'default-study-plan';

            // Firebase initialisieren
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
            } catch (e) {
                console.error("Firebase-Initialisierung fehlgeschlagen:", e);
                statusElement.textContent = "Fehler bei Init.";
                return;
            }

            // Authentifizierung starten
            handleAuth(appId);
            // NEU: Event-Listener für Buttons und Listen einrichten
            setupGlobalEventListeners();
        });

        // --- Authentifizierung (VEREINFACHT FÜR SELF-HOSTING) ---
        async function handleAuth(appId) {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                } else {
                    try {
                        await signInAnonymously(auth);
                        userId = auth.currentUser?.uid;
                    } catch (error) {
                        console.error("Authentifizierungsfehler:", error);
                        console.error("--- WICHTIGER HINWEIS: HAST DU DEINE FIREBASE-KONFIGURATION OBEN (Zeile 314) EINGEFÜGT? ---");
                        statusElement.textContent = "Auth-Fehler (API Key?)";
                    }
                }

                if (userId) {
                    statusElement.textContent = `Verbunden (ID: ${userId.substring(0, 6)}...)`;
                    dbRef = doc(db, `artifacts/${appId}/users/${userId}/study-plan`, 'tasks');
                    loadStateFromFirestore();
                } else {
                    console.error("Konnte keine User-ID erhalten.");
                    statusElement.textContent = "Offline. Fortschritt wird nicht gespeichert.";
                    // Offline arbeiten: Standard-Tasks trotzdem rendern
                    renderAllPhases();
                }
            });
        }

        // --- NEU: Globale Event-Listener (Event Delegation) ---
        function setupGlobalEventListeners() {
            // Für "Add Task" Buttons
            document.querySelectorAll('.add-task-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const phase = btn.dataset.phase;
                    const input = document.getElementById(`new-task-input-${phase}`);
                    if (input.value.trim()) {
                        addTask(phase, input.value.trim());
                        input.value = ''; // Input-Feld leeren
                    }
                });
            });

            // Für Checkboxen und Löschen-Buttons (Event Delegation)
            document.querySelectorAll('.task-list').forEach(list => {
                list.addEventListener('click', (e) => {
                    const phase = list.id.replace('-tasks', ''); // z.B. "phase1"
                    
                    // Checkbox geklickt
                    if (e.target.matches('input[type="checkbox"]')) {
                        const taskId = e.target.id;
                        toggleTask(phase, taskId, e.target.checked);
                    }

                    // Löschen-Button geklickt
                    if (e.target.matches('.delete-task-btn')) {
                        const taskId = e.target.dataset.taskId;
                        deleteTask(phase, taskId);
                    }
                });
            });
        }

        // --- NEU: Alle Phasen auf der UI rendern ---
        function renderAllPhases() {
            Object.keys(taskState).forEach(phase => {
                renderPhase(phase);
            });
        }

        // --- NEU: Eine einzelne Phase rendern ---
        function renderPhase(phase) {
            const listElement = document.getElementById(`${phase}-tasks`);
            if (!listElement) return; // Sicherheitshalber

            listElement.innerHTML = ''; // Liste leeren

            if (!taskState[phase]) {
                taskState[phase] = []; // Phase initialisieren, falls sie fehlt
            }

            taskState[phase].forEach(task => {
                const li = document.createElement('li');
                li.className = 'task-item flex justify-between items-center bg-gray-50 p-2 rounded-lg';
                
                const labelStyle = task.style || '';
                const disabled = task.disabled ? 'disabled' : '';

                li.innerHTML = `
                    <div class="flex-grow">
                        <input type="checkbox" id="${task.id}" ${task.checked ? 'checked' : ''} ${disabled} class="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500">
                        <label for="${task.id}" class="ml-3 ${labelStyle} ${disabled ? 'text-gray-400' : 'text-gray-800'}">
                            ${task.text}
                        </label>
                    </div>
                    ${!disabled ? `<span data-task-id="${task.id}" class="delete-task-btn text-red-400 hover:text-red-600 font-mono" title="Löschen">X</span>` : ''}
                `;
                listElement.appendChild(li);
            });
        }


        // --- NEU: Logik-Funktionen ---
        function addTask(phase, text) {
            const newTask = {
                id: `task-${Date.now()}`, // Eindeutige ID
                text: text,
                checked: false,
                custom: true // Markieren als benutzerdefiniert
            };
            taskState[phase].push(newTask);
            renderPhase(phase); // UI aktualisieren
            saveStateToFirestore(); // In DB speichern
        }

        function toggleTask(phase, taskId, isChecked) {
            const task = taskState[phase].find(t => t.id === taskId);
            if (task) {
                task.checked = isChecked;
                saveStateToFirestore(); // In DB speichern
            }
        }

        function deleteTask(phase, taskId) {
            taskState[phase] = taskState[phase].filter(t => t.id !== taskId);
            renderPhase(phase); // UI aktualisieren
            saveStateToFirestore(); // In DB speichern
        }

        // --- Daten von Firestore laden ---
        function loadStateFromFirestore() {
            if (!dbRef) return;
            statusElement.textContent = "Lade Daten...";
            
            onSnapshot(dbRef, (docSnap) => {
                if (docSnap.exists()) {
                    // Wenn Daten in der DB existieren, überschreibe den Standard-State
                    taskState = docSnap.data();
                } else {
                    // Beim allerersten Laden (oder nach DB-Reset)
                    // taskState behält den vordefinierten Wert
                    console.log("Keine DB-Daten. Verwende Standard-Tasks.");
                    // Optional: Standard-Tasks direkt speichern, um DB zu initialisieren
                    saveStateToFirestore();
                }
                renderAllPhases(); // UI mit geladenen oder Standard-Tasks aufbauen
                statusElement.textContent = `Synchronisiert (ID: ${userId.substring(0, 6)}...)`;
            }, (error) => {
                console.error("Fehler beim Laden von Firestore:", error);
                statusElement.textContent = "Sync-Fehler";
                renderAllPhrases(); // UI trotzdem mit Standard-Tasks aufbauen
            });
        }

        // --- Daten in Firestore speichern (mit Debounce) ---
        function saveStateToFirestore() {
            if (!userId || !dbRef) return; // Nicht speichern, wenn nicht verbunden

            clearTimeout(debounceTimer);
            statusElement.textContent = "Änderungen erkannt...";
            statusElement.classList.add('syncing');
            
            debounceTimer = setTimeout(async () => {
                try {
                    // Speichere das *gesamte* taskState-Objekt
                    await setDoc(dbRef, taskState, { merge: false });
                    statusElement.textContent = `Synchronisiert (ID: ${userId.substring(0, 6)}...)`;
                } catch (error) {
                    console.error("Fehler beim Speichern in Firestore:", error);
                    statusElement.textContent = "Speicherfehler!";
                } finally {
                    statusElement.classList.remove('syncing');
                }
            }, 1500); // 1.5 Sekunden Verzögerung
        }

    </script>
</body>
</html>
