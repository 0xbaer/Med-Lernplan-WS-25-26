<!DOCTYPE html>
<html lang="de" class="h-full bg-gray-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mwin Medi-Lernplan WS 25/26 </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Stil für abgehakte Aufgaben */
        .task-item input:checked + label .edit-span {
            text-decoration: line-through;
            color: #6b7280; /* gray-500 */
        }
        .task-item label, .goal-item .edit-span {
            transition: color 0.2s ease-in-out;
            cursor: pointer;
            display: inline-block; /* Wichtig für Klickbarkeit */
            width: 100%;
        }
        /* Hover-Effekt für editierbare Texte */
        .goal-item .edit-span:hover, .task-item label .edit-span:hover {
            background-color: #eff6ff; /* blue-50 */
            border-radius: 3px;
            box-shadow: 0 0 0 1px #dbeafe; /* blue-100 */
        }
        /* Speicher-Animation */
        #save-status.syncing::after {
            content: ' .';
            animation: dots 1s steps(5, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: ' .'; }
            40% { content: ' ..'; }
            60% { content: ' ...'; }
            80%, 100% { content: ' '; }
        }
        /* Löschen-Button (rotes X) */
        .delete-btn {
            opacity: 0.3;
            transition: opacity 0.2s;
            cursor: pointer;
            font-weight: bold;
            padding: 0 4px;
            font-family: monospace;
            color: #ef4444; /* red-500 */
        }
        .task-item:hover .delete-btn, .goal-item:hover .delete-btn {
            opacity: 1;
        }
        /* Eingabefeld, das beim Editieren erscheint */
        .editing-input {
            width: 95%;
            padding: 2px 4px;
            border: 1px solid #3b82f6; /* blue-500 */
            border-radius: 3px;
            outline: none;
            font: inherit;
        }
    </style>
</head>
<body class="h-full p-4 md:p-8 bg-gray-100">
    <div class="max-w-7xl mx-auto">
        <header class="mb-8">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">Dein Med-Lernplan WS 25/26 (V10)</h1>
                    <p class="text-lg text-gray-600">Interaktiver Plan - Lokal, editierbar & dynamisch.</p>
                </div>
                <div class="text-right">
                    <span id="save-status" class="text-sm text-gray-500">Bereit</span>
                </div>
            </div>
        </header>

        <!-- Container für die Lernphasen -->
        <div class="space-y-8" id="plan-container">

            <!-- Phase 1: Aktueller Fokus -->
            <section class="bg-white p-6 rounded-xl shadow-lg border border-blue-200">
                <h2 class="text-2xl font-semibold text-blue-700 mb-4">Phase 1: Aktueller Fokus (Bis 07.11.2025)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Ziele (Links) -->
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Ziele</h3>
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="new-goal-input-phase1" placeholder="Neues Ziel..." class="flex-grow border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-300">
                            <button data-phase="phase1" data-type="goals" class="add-btn bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-semibold">Add</button>
                        </div>
                        <ul class="space-y-3 goal-list" id="phase1-goals">
                            <!-- JS fügt Ziele hier ein -->
                        </ul>
                    </div>
                    <!-- Tracking (Rechts) -->
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Tracking-Liste</h3>
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="new-task-input-phase1" placeholder="Neue Aufgabe..." class="flex-grow border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-300">
                            <button data-phase="phase1" data-type="tasks" class="add-btn bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-semibold">Add</button>
                        </div>
                        <ul class="space-y-2 task-list" id="phase1-tasks">
                            <!-- JS fügt Tasks hier ein -->
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Phase 2: Der Große Dauerlauf -->
            <section class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Phase 2: Der große Dauerlauf (08.11. - 20.12.2025)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Ziele (Links) -->
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Ziele</h3>
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="new-goal-input-phase2" placeholder="Neues Ziel..." class="flex-grow border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300">
                            <button data-phase="phase2" data-type="goals" class="add-btn bg-gray-700 hover:bg-gray-800 text-white px-3 py-2 rounded-lg text-sm font-semibold">Add</button>
                        </div>
                        <ul class="space-y-3 goal-list" id="phase2-goals">
                            <!-- JS fügt Ziele hier ein -->
                        </ul>
                    </div>
                    <!-- Tracking (Rechts) -->
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Tracking-Liste</h3>
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="new-task-input-phase2" placeholder="Neue Aufgabe..." class="flex-grow border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300">
                            <button data-phase="phase2" data-type="tasks" class="add-btn bg-gray-700 hover:bg-gray-800 text-white px-3 py-2 rounded-lg text-sm font-semibold">Add</button>
                        </div>
                        <ul class="space-y-2 task-list" id="phase2-tasks">
                            <!-- JS fügt Tasks hier ein -->
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Phase 3: Fokus Anatomie & Biochemie -->
            <section class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Phase 3: Ana-Endspurt & Biochemie (21.12.2025 - 20.01.2026)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Ziele (Links) -->
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Hauptziele</h3>
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="new-goal-input-phase3" placeholder="Neues Ziel..." class="flex-grow border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300">
                            <button data-phase="phase3" data-type="goals" class="add-btn bg-gray-700 hover:bg-gray-800 text-white px-3 py-2 rounded-lg text-sm font-semibold">Add</button>
                        </div>
                         <ul class="space-y-3 goal-list" id="phase3-goals">
                            <!-- JS fügt Ziele hier ein -->
                        </ul>
                    </div>
                    <!-- Tracking (Rechts) -->
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Tracking-Liste</h3>
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="new-task-input-phase3" placeholder="Neue Aufgabe..." class="flex-grow border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300">
                            <button data-phase="phase3" data-type="tasks" class="add-btn bg-gray-700 hover:bg-gray-800 text-white px-3 py-2 rounded-lg text-sm font-semibold">Add</button>
                        </div>
                        <ul class="space-y-2 task-list" id="phase3-tasks">
                            <!-- JS fügt Tasks hier ein -->
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Phase 4: Klausurenphase -->
            <section class="bg-white p-6 rounded-xl shadow-lg border border-red-300">
                <h2 class="text-2xl font-semibold text-red-700 mb-4">Phase 4: Klausurenphase (21.01. - 07.02.2026)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Ziele (Links) -->
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Alle Klausuren</h3>
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="new-goal-input-phase4" placeholder="Neues Ziel..." class="flex-grow border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-red-300">
                            <button data-phase="phase4" data-type="goals" class="add-btn bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm font-semibold">Add</button>
                        </div>
                        <ul class="space-y-3 goal-list" id="phase4-goals">
                            <!-- JS fügt Ziele hier ein -->
                        </ul>
                    </div>
                    <!-- Tracking (Rechts) -->
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Tracking-Liste</h3>
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="new-task-input-phase4" placeholder="Neue Aufgabe..." class="flex-grow border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-red-300">
                            <button data-phase="phase4" data-type="tasks" class="add-btn bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm font-semibold">Add</button>
                        </div>
                        <ul class="space-y-2 task-list" id="phase4-tasks">
                            <!-- JS fügt Tasks hier ein -->
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Phase 5: Langfristige Ziele -->
            <section class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Phase 5: Langfristige Ziele (Frühjahr 2026)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Ziele (Links) -->
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Zukünftige Prüfungen</h3>
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="new-goal-input-phase5" placeholder="Neues Ziel..." class="flex-grow border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300">
                            <button data-phase="phase5" data-type="goals" class="add-btn bg-gray-700 hover:bg-gray-800 text-white px-3 py-2 rounded-lg text-sm font-semibold">Add</button>
                        </div>
                         <ul class="space-y-3 goal-list" id="phase5-goals">
                            <!-- JS fügt Ziele hier ein -->
                        </ul>
                    </div>
                    <!-- Tracking (Rechts) -->
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Tracking-Liste</h3>
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="new-task-input-phase5" placeholder="Neue Aufgabe..." class="flex-grow border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300">
                            <button data-phase="phase5" data-type="tasks" class="add-btn bg-gray-700 hover:bg-gray-800 text-white px-3 py-2 rounded-lg text-sm font-semibold">Add</button>
                        </div>
                        <ul class="space-y-2 task-list" id="phase5-tasks">
                            <!-- JS fügt Tasks hier ein -->
                        </ul>
                    </div>
                </div>
            </section>

        </div>
    </div>

    <!-- Lokales Speicher-Skript (V10 - Voll Dynamisch) -->
    <script type="module">
        
        // --- Globale Variablen ---
        let debounceTimer; // Für verzögertes Speichern
        const statusElement = document.getElementById('save-status');
        const LOCAL_STORAGE_KEY = 'meinMedizinLernplan_V10'; // Neuer Key für neue Struktur
        const planContainer = document.getElementById('plan-container');

        // --- Standard-Datenstruktur (Ziele & Aufgaben) ---
        const defaultData = {
            phase1: {
                goals: [
                    { id: 'goal1-1', text: '<strong>Testat:</strong> Wöchentlicher Physio-Test (07.11.)', style: 'p-4 bg-blue-50 rounded-lg text-blue-800' }
                ],
                tasks: [
                    { id: 'task1-1', text: 'Thema "Blut I" (Zusammensetzung) lernen', checked: false, style: '' },
                    { id: 'task1-2', text: 'Thema "Erythrozyten & Anämien" verstehen', checked: false, style: '' },
                    { id: 'task1-3', text: 'Thema "Blutgruppen" wiederholen', checked: false, style: '' },
                    { id: 'task1-4', text: 'Plan für AC-Selbststudium erstellen (z.B. 1 Thema/Woche)', checked: false, style: '' }
                ]
            },
            phase2: {
                goals: [
                    { id: 'goal2-1', text: '<strong>Ana-Blöcke 1-3</strong> (Rumpf, Arm, Bein)', style: 'p-4 bg-red-50 rounded-lg text-red-800 font-medium' },
                    { id: 'goal2-2', text: '<strong>Dauerlauf</strong> AC-Selbststudium', style: 'p-4 bg-orange-50 rounded-lg text-orange-800 font-medium' },
                    { id: 'goal2-3', text: '<strong>Dauerlauf:</strong> Wöchentliche Physio-Tests', style: 'p-4 bg-blue-50 rounded-lg text-blue-800' },
                    { id: 'goal2-4', text: '<strong>Physio-Ziel:</strong> 26 Punkte (min.)<br><strong>Status:</strong> 11/26<br><strong>Bedarf:</strong> 15 Punkte aus 6 Tests (Schnitt: 2.5/6)', style: 'p-4 bg-blue-100 rounded-lg text-blue-900 border border-blue-300' },
                    { id: 'goal2-5', text: '<strong>Klausur:</strong> Med. Psychologie (09.12.)', style: 'p-4 bg-yellow-50 rounded-lg text-yellow-800' },
                    { id: 'goal2-6', text: '<strong>Urlaub:</strong> 19.11. - 21.11. (Buenos Aires!)', style: 'p-4 bg-teal-50 rounded-lg text-teal-800' }
                ],
                tasks: [
                    { id: 'task2-1', text: 'Ana-Block 1: Rumpfwand & Rücken (bis ca. 22.11.)', checked: false, style: 'font-semibold text-red-700' },
                    { id: 'task2-2', text: 'Wöchentlich 1-2 feste Blöcke für AC-Selbststudium einplanen', checked: false, style: '' },
                    { id: 'task2-3', text: 'Physio Test (14.11.): Blut II (Hämostase, Immunologie)', checked: false, style: '' },
                    { id: 'task-vacation', text: 'Blocker: URLAUB (19.11. - 21.11.)', checked: true, disabled: true, style: 'text-teal-700 font-medium' },
                    { id: 'task2-4', text: 'Nachholen (nach 21.11.): Physio-Stoff "Energiehaushalt"', checked: false, style: '' },
                    { id: 'task2-5', text: 'Ana-Block 2: Obere Extremität (bis ca. 06.12.)', checked: false, style: 'font-semibold text-red-700' },
                    { id: 'task2-6', text: 'Ab 25.11.: Intensiv-Lernphase Med. Psychologie starten', checked: false, style: '' },
                    { id: 'task2-7', text: 'Physio Test (28.11.): Atmung I', checked: false, style: '' },
                    { id: 'task2-8', text: 'Physio Test (05.12.): Atmung II', checked: false, style: '' },
                    { id: 'task2-9', text: 'Physio Test (12.12.): Niere I', checked: false, style: '' },
                    { id: 'task2-10', text: 'Ana-Block 3: Untere Extremität (bis ca. 20.12.)', checked: false, style: 'font-semibold text-red-700' },
                    { id: 'task2-11', text: 'Physio Test (19.12.): Elektrolyt-/Säure-Basen', checked: false, style: '' },
                    { id: 'task2-12', text: 'Histo: Themen parallel zu Makro-Blöcken lernen', checked: false, style: '' }
                ]
            },
            phase3: {
                goals: [
                    { id: 'goal3-1', text: '<strong>WEIHNACHTSPAUSE:</strong> (21.12. - 26.12.)', style: 'p-4 bg-teal-50 rounded-lg text-teal-800 font-medium' },
                    { id: 'goal3-2', text: '<strong>Ana-Blöcke 4-6</strong> (Organe, Kopf/Hals)', style: 'p-4 bg-red-50 rounded-lg text-red-800' },
                    { id: 'goal3-3', text: '<strong>Start Biochemie Praktikum:</strong> 07.01.2026', style: 'p-4 bg-green-50 rounded-lg text-green-800 font-medium' },
                    { id: 'goal3-4', text: '<strong>FINALE: Ganzkörpertestat:</strong> 20.01.2026', style: 'p-4 bg-red-100 rounded-lg text-red-900 font-medium border border-red-300' }
                ],
                tasks: [
                    { id: 'task-xmas', text: 'Blocker: WEIHNACHTSPAUSE (21.12. - 26.12.)', checked: true, disabled: true, style: 'text-teal-700 font-medium' },
                    { id: 'task3-1', text: 'Ana-Block 4: Brustorgane (27.12. - 05.01.)', checked: false, style: 'font-semibold text-red-700' },
                    { id: 'task3-2', text: 'Vor 07.01.: Überblick Biochemie-Praktikumsthemen', checked: false, style: '' },
                    { id: 'task3-3', text: 'Praktikum (ab 07.01.) täglich vor/nachbereiten', checked: false, style: '' },
                    { id: 'task3-4', text: 'Ana-Block 5: Bauch- & Beckenorgane (06.01. - 12.01.)', checked: false, style: 'font-semibold text-red-700' },
                    { id: 'task3-5', text: 'Ana-Block 6: Kopf & Hals (13.01. - 18.01.)', checked: false, style: 'font-semibold text-red-700' },
                    { id: 'task3-6', text: 'Ana-Block 7: Puffer & Finale Repetition (19.01. - 20.01.)', checked: false, style: 'font-bold text-red-900' },
                    { id: 'task3-7', text: 'Parallel AC-Selbststudium weiterführen!', checked: false, style: '' }
                ]
            },
            phase4: {
                goals: [
                    { id: 'goal4-1', text: '<strong>Biochemie:</strong> 04.02.2026 (9:00)', style: 'p-4 bg-gray-50 rounded-lg text-gray-800' },
                    { id: 'goal4-2', text: '<strong>Terminologie:</strong> 04.02.2026 (11:00)', style: 'p-4 bg-gray-50 rounded-lg text-gray-800' },
                    { id: 'goal4-3', text: '<strong>Biologie:</strong> 06.02.2026 (12:00)', style: 'p-4 bg-gray-50 rounded-lg text-gray-800' },
                    { id: 'goal4-4', text: '<strong>Chemie (AC):</strong> 07.02.2026 (9:00)', style: 'p-4 bg-gray-50 rounded-lg text-gray-800' }
                ],
                tasks: [
                    { id: 'task4-1', text: 'Ab 21.01.: Fokus auf Biochemie (Nachbereitung Praktikum) & Termi', checked: false, style: '' },
                    { id: 'task4-2', text: 'Terminologie Vokabeln lernen', checked: false, style: '' },
                    { id: 'task4-3', text: '04.02. & 05.02.: Fokus auf Biologie für Mediziner', checked: false, style: '' },
                    { id: 'task4-4', text: '06.02.: Finale Lernphase für AC-Klausur', checked: false, style: '' }
                ]
            },
            phase5: {
                goals: [
                    { id: 'goal5-1', text: '<strong>Physiologie Praktikum:</strong> 11.03. - 02.04.2026', style: 'p-4 bg-blue-50 rounded-lg text-blue-800' },
                    { id: 'goal5-2', text: '<strong>Klausur Physiologie:</strong> 09.04.2026', style: 'p-4 bg-blue-50 rounded-lg text-blue-800 font-medium' },
                    { id: 'goal5-3', text: '<strong>Klausur Chemie (OC):</strong> April 2026 (TBD)', style: 'p-4 bg-yellow-50 rounded-lg text-yellow-800' }
                ],
                tasks: [
                    { id: 'task5-1', text: 'Nach Feb-Klausuren: Pause machen!', checked: false, style: '' },
                    { id: 'task5-2', text: 'Ab Ende Feb.: Physiologie-Stoff der Wochentests reaktivieren', checked: false, style: '' },
                    { id: 'task5-3', text: 'Physiologie-Praktikum (März) intensiv nutzen', checked: false, style: '' },
                    { id: 'task5-4', text: 'Lernplan für OC-Klausur erstellen', checked: false, style: '' }
                ]
            }
        };

        // Der aktuelle Status der Daten
        let dataState;

        // --- Initialisierung ---
        document.addEventListener('DOMContentLoaded', () => {
            loadStateFromLocalStorage();
            setupGlobalEventListeners();
            renderAllPhases(); // UI beim Start aufbauen
        });

        // --- Globale Event-Listener (Event Delegation) ---
        function setupGlobalEventListeners() {
            planContainer.addEventListener('click', (e) => {
                const target = e.target;

                // --- Add-Button ---
                if (target.classList.contains('add-btn')) {
                    const phase = target.dataset.phase;
                    const type = target.dataset.type; // 'goals' or 'tasks'
                    const input = document.getElementById(`new-${type.slice(0, -1)}-input-${phase}`);
                    if (input && input.value.trim()) {
                        addItem(phase, type, input.value.trim());
                        input.value = ''; // Input-Feld leeren
                    }
                }

                // --- Delete-Button ---
                if (target.classList.contains('delete-btn')) {
                    const { phase, type, id } = target.dataset;
                    deleteItem(phase, type, id);
                }

                // --- Checkbox ---
                if (target.matches('input[type="checkbox"]')) {
                    const { phase, id } = target.dataset;
                    toggleTask(phase, id, target.checked);
                }
                
                // --- Edit-Span ---
                if (target.classList.contains('edit-span') && !target.isContentEditable) {
                    startEditing(target);
                }
            });
        }
        
        // --- Editier-Logik ---
        function startEditing(span) {
            // Verhindern, dass ein Klick auf ein bereits editierendes Element alles kaputt macht
            if (span.dataset.editing === 'true') return;
            span.dataset.editing = 'true';
            
            const { phase, type, id } = span.dataset;
            const originalHtml = span.innerHTML; // HTML speichern (für <strong> etc.)
            const originalText = span.textContent; // Nur Text für das Input-Feld
            
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'editing-input';
            input.value = originalText;

            // Span durch Input ersetzen
            span.innerHTML = '';
            span.appendChild(input);
            input.focus();
            input.select();

            // Event-Listener für das Input-Feld
            const save = () => {
                const newHtml = input.value.trim() || originalText; // Leere Eingaben verhindern
                // Finde das Item und update seinen Text
                const item = dataState[phase][type].find(i => i.id === id);
                if (item) {
                    // Simples HTML-Parsing, um <strong> zu erhalten
                    if (originalHtml.includes('<strong>')) {
                         item.text = `<strong>${newHtml.replace(/<\/?strong>/g, '')}</strong>`;
                    } else {
                         item.text = newHtml;
                    }
                    saveStateToLocalStorage();
                }
                // Input wieder durch Span ersetzen (neu rendern)
                span.innerHTML = item ? item.text : originalHtml;
                span.dataset.editing = 'false';
            };

            input.addEventListener('blur', save);
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    save();
                } else if (e.key === 'Escape') {
                    // Abbrechen: Input durch originalen Span ersetzen
                    span.innerHTML = originalHtml;
                    span.dataset.editing = 'false';
                }
            });
        }

        // --- Alle Phasen auf der UI rendern ---
        function renderAllPhases() {
            Object.keys(dataState).forEach(phase => {
                renderPhase(phase, 'goals');
                renderPhase(phase, 'tasks');
            });
        }

        // --- Eine einzelne Liste (Ziele oder Tasks) rendern ---
        function renderPhase(phase, type) { // type is 'goals' or 'tasks'
            const listElement = document.getElementById(`${phase}-${type}`);
            if (!listElement) return; 

            listElement.innerHTML = ''; // Liste leeren

            if (!dataState[phase] || !dataState[phase][type]) {
                return; // Daten (noch) nicht vorhanden
            }

            dataState[phase][type].forEach(item => {
                let li;
                if (type === 'goals') {
                    li = createGoalElement(item, phase);
                } else {
                    li = createTaskElement(item, phase);
                }
                listElement.appendChild(li);
            });
        }
        
        // --- HTML für ein Ziel-Element erstellen ---
        function createGoalElement(goal, phase) {
            const li = document.createElement('li');
            li.className = `goal-item flex justify-between items-center ${goal.style || 'p-4 bg-gray-50 rounded-lg text-gray-800'}`;
            li.innerHTML = `
                <span class="edit-span flex-grow" data-phase="${phase}" data-type="goals" data-id="${goal.id}">${goal.text}</span>
                <span data-phase="${phase}" data-type="goals" data-id="${goal.id}" class="delete-btn" title="Löschen">X</span>
            `;
            return li;
        }

        // --- HTML für ein Task-Element erstellen ---
        function createTaskElement(task, phase) {
            const li = document.createElement('li');
            li.className = 'task-item flex justify-between items-center bg-gray-50 p-2 rounded-lg';
            
            const labelStyle = task.style || '';
            const disabled = task.disabled ? 'disabled' : '';

            li.innerHTML = `
                <div class="flex-grow flex items-center">
                    <input type="checkbox" id="${task.id}" data-phase="${phase}" data-id="${task.id}" ${task.checked ? 'checked' : ''} ${disabled} class="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500 flex-shrink-0">
                    <label for="${task.id}" class="ml-3 ${labelStyle} ${disabled ? 'text-gray-400' : 'text-gray-800'} w-full">
                         <span class="edit-span" data-phase="${phase}" data-type="tasks" data-id="${task.id}">${task.text}</span>
                    </label>
                </div>
                ${!disabled ? `<span data-phase="${phase}" data-type="tasks" data-id="${task.id}" class="delete-btn" title="Löschen">X</span>` : ''}
            `;
            return li;
        }


        // --- CRUD-Logik-Funktionen ---
        
        function addItem(phase, type, text) {
            const newItem = {
                id: `item-${Date.now()}`, // Eindeutige ID
                text: text,
                style: (type === 'goals') ? 'p-4 bg-gray-50 rounded-lg text-gray-800' : '', // Standardstil
                checked: false, // Nur für Tasks relevant, stört bei Zielen nicht
                custom: true
            };
            dataState[phase][type].push(newItem);
            renderPhase(phase, type); // Nur die betroffene Liste neu rendern
            saveStateToLocalStorage();
        }

        function toggleTask(phase, taskId, isChecked) {
            const task = dataState[phase].tasks.find(t => t.id === taskId);
            if (task) {
                task.checked = isChecked;
                saveStateToLocalStorage();
            }
        }

        function deleteItem(phase, type, id) {
            dataState[phase][type] = dataState[phase][type].filter(item => item.id !== id);
            renderPhase(phase, type); // Nur die betroffene Liste neu rendern
            saveStateToLocalStorage();
        }

        // --- Daten von localStorage laden ---
        function loadStateFromLocalStorage() {
            statusElement.textContent = "Lade...";
            const savedState = localStorage.getItem(LOCAL_STORAGE_KEY);
            
            if (savedState) {
                dataState = JSON.parse(savedState);
                // Stelle sicher, dass alle Phasen/Typen existieren
                Object.keys(defaultData).forEach(phase => {
                    if (!dataState[phase]) {
                        dataState[phase] = defaultData[phase]; // Ganze Phase fehlt
                    } else {
                        if (!dataState[phase].goals) dataState[phase].goals = defaultData[phase].goals;
                        if (!dataState[phase].tasks) dataState[phase].tasks = defaultData[phase].tasks;
                    }
                });

            } else {
                // Beim allerersten Laden
                dataState = JSON.parse(JSON.stringify(defaultData)); // Tiefe Kopie
                console.log("Keine lokalen Daten. Verwende Standard-Daten.");
            }
            statusElement.textContent = "Bereit";
        }

        // --- Daten in localStorage speichern (mit Debounce) ---
        function saveStateToLocalStorage() {
            clearTimeout(debounceTimer);
            statusElement.textContent = "Speichere...";
            statusElement.classList.add('syncing');
            
            debounceTimer = setTimeout(() => {
                try {
                    localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(dataState));
                    statusElement.textContent = "Lokal gespeichert";
                } catch (error) {
                    console.error("Fehler beim Speichern in localStorage:", error);
                    statusElement.textContent = "Speicherfehler!";
                } finally {
                    statusElement.classList.remove('syncing');
                }
            }, 1000); // 1 Sekunde Verzögerung
        }

    </script>
</body>
</html>
